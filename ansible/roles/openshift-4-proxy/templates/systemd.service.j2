[Unit]
Description=OpenShift 4 {{ proxy_name }})
After=network.target libvirtd.service

[Service]
Type=simple
TimeoutStartSec=5m

EnvironmentFile=/etc/sysconfig/{{ proxy_name }}.env

ExecStartPre=-/usr/bin/podman rm "{{ proxy_name }}"
ExecStartPre=/usr/bin/podman pull {{ proxy_container_image }}
ExecStart=/usr/bin/podman run --name {{ proxy_name }} --net host \
  --expose 3128 \
  --group-add tty \
  --tty \
  --privileged \
  --volume /etc/sysconfig/{{ proxy_name }}.conf:/etc/squid/squid.conf:ro \
  --volume ${SQUID_DIR}:/var/spool/squid:rw,noexec,nosuid,z \
  {{ proxy_container_image }}

ExecReload=-/usr/bin/podman stop "{{ proxy_name }}"
ExecReload=-/usr/bin/podman rm "{{ proxy_name }}"
ExecStop=-/usr/bin/podman stop "{{ proxy_name }}"
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target
