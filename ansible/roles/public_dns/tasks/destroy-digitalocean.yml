- name: Create DNS record at DigitalOcean
  community.digitalocean.digital_ocean_domain_record:
    oauth_token: "{{ digitalocean_token }}"
    state: absent
    domain: "{{ digitalocean_zone }}"
    type: A
    name: "{{ item }}.{{ cluster_name }}"
    data: "{{ pd_public_ip }}"
  with_items:
    - api
    - '*.apps'
  tags:
    - public_dns
  when: (pd_public_ip is defined) and (pd_public_ip|length > 0)


- name: Create IPv6 DNS record at DigitalOcean
  community.digitalocean.digital_ocean_domain_record:
    oauth_token: "{{ digitalocean_token }}"
    state: absent
    domain: "{{ digitalocean_zone }}"
    type: AAAA
    name: "{{ item }}.{{ cluster_name }}"
    data: "{{ pd_public_ipv6 }}"
  with_items:
    - api
    - '*.apps'
  tags:
    - public_dns
  when: (pd_public_ipv6 is defined) and (pd_public_ipv6|length > 0)